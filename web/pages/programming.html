<div class="fade_in text-center">
	<h1 class="heading1">Programming</h1>
	<div class="panel panel-default">
		<div class="panel-heading clearfix">
			<h4 class="panel-title">Code Editor
				<div class="pull-right">
					<select class="form-control" id="language-select" onchange="update_highlighting()">
						<option value="python2">Python 2</option>
						<option value="python3">Python 3</option>
						<option value="java">Java</option>
					</select>
				</div>
			</h4>
		</div>
		<br>
		<div style="text-align: left" class="panel-body" id="editor">
		</div>
	</div>
</div>
<div id="programming_msg"/>
<div class="input-group">
	<select class="form-control" id="problem-select">
		<option ng-repeat="problem in data.problems" ng-value="problem.pid">{{ problem.title }}</option>
	</select>
	<span class="input-group-btn">
		<button class="btn btn-success" type="button" onclick="submit(); return false;">Submit</button>
	</span>
</div>
<script>
var update_highlighting = function() {
	var language = $("#language-select").val();
	if (language == "python3") {
		language = "python";
	}
	var editor = ace.edit("editor");
	editor.getSession().setMode("ace/mode/" + language);
}

var submit = function() {
	data = {};
	var pid = $("#problem-select").val();
	var language = $("#language-select").val();
	var editor = ace.edit("editor");
	var program = editor.getValue();
	data["pid"] = pid;
	data["language"] = language;
	data["submission"] = program;
	api_call("POST", "/api/programming/submit", data, function(result) {
		if (result["success"] == 1) {
			display_message("programming_msg", "success", result["message"], function() {
			});
		} else {
			display_message("programming_msg", "danger", result["message"], function() {
			});
		}
	}, function(jqXHR, status, error) {
		var result = jqXHR["responseText"];
		display_message("programming_msg", "danger", "Error " + jqXHR["status"] + ": " + result["message"], function() {
		});
	});
}
</script>
